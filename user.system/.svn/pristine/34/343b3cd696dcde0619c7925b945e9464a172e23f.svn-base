package liuzhuomin.cloud.controller;

import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import liuzhuomin.cloud.DTO.TokenDto;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.security.core.authority.AuthorityUtils;
import org.springframework.security.oauth2.provider.OAuth2Authentication;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Set;

/**
 * <B>Title:</B>AuthenticationController</br>
 * <B>Description:</B>  </br>
 * <B>Copyright: </B>Copyright (c) 2019 </br>
 *
 * @author liuliuliu
 * @version 1.0
 * @date2019/6/25 16:11
 */
@RestController
@RequestMapping("oauth")
@Api("用户授权验证相关接口")
public class AuthenticationController {

    private final static Logger LOGGER= LoggerFactory.getLogger(AuthenticationController.class);

    @ApiOperation("通过token令牌获取用户相关简略信息,包含用户名和角色")
    @RequestMapping(value = "user", produces = "application/json")
    public TokenDto user(OAuth2Authentication auth2Authentication) {
        Object principal = auth2Authentication.getUserAuthentication().getPrincipal();
        Set<String> strings = AuthorityUtils.authorityListToSet(auth2Authentication.getUserAuthentication().getAuthorities());
        LOGGER.info("princicpal{}",principal);
        return new TokenDto(principal, strings);
    }



}
